<template>
  <div class="signup-page">
    <div class="left-rect">
      <span class="logo">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="111"
          height="34"
          viewBox="0 0 111 34"
          fill="none"
        >
          <g id="Noodle">
            <path
              d="M2.04 25V3.82H5.34L6.75 8.05V25H2.04ZM16.65 25L4.17 9.01L5.34 3.82L17.82 19.81L16.65 25ZM16.65 25L15.39 20.77V3.82H20.1V25H16.65ZM64.5488 25.3C63.1688 25.3 61.9388 24.97 60.8588 24.31C59.7988 23.65 58.9588 22.75 58.3388 21.61C57.7388 20.47 57.4388 19.17 57.4388 17.71C57.4388 16.25 57.7388 14.95 58.3388 13.81C58.9588 12.67 59.7988 11.77 60.8588 11.11C61.9388 10.45 63.1688 10.12 64.5488 10.12C65.5488 10.12 66.4488 10.31 67.2488 10.69C68.0688 11.07 68.7388 11.6 69.2588 12.28C69.7988 12.94 70.0988 13.7 70.1588 14.56V20.71C70.0988 21.57 69.8088 22.35 69.2888 23.05C68.7688 23.73 68.0988 24.28 67.2788 24.7C66.4588 25.1 65.5488 25.3 64.5488 25.3ZM65.3588 21.16C66.0188 21.16 66.5888 21.02 67.0688 20.74C67.5488 20.44 67.9288 20.03 68.2088 19.51C68.4888 18.99 68.6288 18.39 68.6288 17.71C68.6288 17.03 68.4888 16.44 68.2088 15.94C67.9488 15.42 67.5688 15.01 67.0688 14.71C66.5888 14.41 66.0288 14.26 65.3888 14.26C64.7488 14.26 64.1788 14.41 63.6788 14.71C63.1988 15.01 62.8088 15.42 62.5088 15.94C62.2288 16.46 62.0888 17.05 62.0888 17.71C62.0888 18.37 62.2288 18.96 62.5088 19.48C62.7888 20 63.1788 20.41 63.6788 20.71C64.1788 21.01 64.7388 21.16 65.3588 21.16ZM72.9488 25H68.4488V21.07L69.1388 17.53L68.3588 13.99V3.22H72.9488V25ZM76.1805 25V3.22H80.7705V25H76.1805ZM91.2028 25.33C89.6228 25.33 88.2128 25.01 86.9728 24.37C85.7528 23.71 84.7928 22.8 84.0928 21.64C83.3928 20.48 83.0428 19.17 83.0428 17.71C83.0428 16.25 83.3828 14.95 84.0628 13.81C84.7628 12.65 85.7028 11.74 86.8828 11.08C88.0628 10.42 89.3928 10.09 90.8728 10.09C92.3128 10.09 93.5828 10.4 94.6828 11.02C95.7828 11.64 96.6428 12.5 97.2628 13.6C97.9028 14.7 98.2228 15.96 98.2228 17.38C98.2228 17.64 98.2028 17.92 98.1628 18.22C98.1428 18.5 98.0928 18.83 98.0128 19.21L85.4428 19.24V16.09L96.0628 16.06L94.0828 17.38C94.0628 16.54 93.9328 15.85 93.6928 15.31C93.4528 14.75 93.0928 14.33 92.6128 14.05C92.1528 13.75 91.5828 13.6 90.9028 13.6C90.1828 13.6 89.5528 13.77 89.0128 14.11C88.4928 14.43 88.0828 14.89 87.7828 15.49C87.5028 16.09 87.3628 16.82 87.3628 17.68C87.3628 18.54 87.5128 19.28 87.8128 19.9C88.1328 20.5 88.5728 20.97 89.1328 21.31C89.7128 21.63 90.3928 21.79 91.1728 21.79C91.8928 21.79 92.5428 21.67 93.1228 21.43C93.7028 21.17 94.2128 20.79 94.6528 20.29L97.1728 22.81C96.4528 23.65 95.5828 24.28 94.5628 24.7C93.5428 25.12 92.4228 25.33 91.2028 25.33Z"
              fill="#402F47"
            />
            <path
              d="M30.7884 25.33C29.2884 25.33 27.9284 25 26.7084 24.34C25.5084 23.66 24.5584 22.74 23.8584 21.58C23.1584 20.42 22.8084 19.12 22.8084 17.68C22.8084 16.24 23.1584 14.95 23.8584 13.81C24.5584 12.67 25.5084 11.77 26.7084 11.11C27.9084 10.43 29.2684 10.09 30.7884 10.09C32.3084 10.09 33.6684 10.42 34.8684 11.08C36.0684 11.74 37.0184 12.65 37.7184 13.81C38.4184 14.95 38.7684 16.24 38.7684 17.68C38.7684 19.12 38.4184 20.42 37.7184 21.58C37.0184 22.74 36.0684 23.66 34.8684 24.34C33.6684 25 32.3084 25.33 30.7884 25.33ZM30.7884 21.16C31.4484 21.16 32.0284 21.02 32.5284 20.74C33.0284 20.44 33.4084 20.03 33.6684 19.51C33.9484 18.97 34.0884 18.36 34.0884 17.68C34.0884 17 33.9484 16.41 33.6684 15.91C33.3884 15.39 32.9984 14.99 32.4984 14.71C32.0184 14.41 31.4484 14.26 30.7884 14.26C30.1484 14.26 29.5784 14.41 29.0784 14.71C28.5784 14.99 28.1884 15.39 27.9084 15.91C27.6284 16.43 27.4884 17.03 27.4884 17.71C27.4884 18.37 27.6284 18.97 27.9084 19.51C28.1884 20.03 28.5784 20.44 29.0784 20.74C29.5784 21.02 30.1484 21.16 30.7884 21.16ZM48.0736 25.33C46.5736 25.33 45.2136 25 43.9936 24.34C42.7936 23.66 41.8436 22.74 41.1436 21.58C40.4436 20.42 40.0936 19.12 40.0936 17.68C40.0936 16.24 40.4436 14.95 41.1436 13.81C41.8436 12.67 42.7936 11.77 43.9936 11.11C45.1936 10.43 46.5536 10.09 48.0736 10.09C49.5936 10.09 50.9536 10.42 52.1536 11.08C53.3536 11.74 54.3036 12.65 55.0036 13.81C55.7036 14.95 56.0536 16.24 56.0536 17.68C56.0536 19.12 55.7036 20.42 55.0036 21.58C54.3036 22.74 53.3536 23.66 52.1536 24.34C50.9536 25 49.5936 25.33 48.0736 25.33ZM48.0736 21.16C48.7336 21.16 49.3136 21.02 49.8136 20.74C50.3136 20.44 50.6936 20.03 50.9536 19.51C51.2336 18.97 51.3736 18.36 51.3736 17.68C51.3736 17 51.2336 16.41 50.9536 15.91C50.6736 15.39 50.2836 14.99 49.7836 14.71C49.3036 14.41 48.7336 14.26 48.0736 14.26C47.4336 14.26 46.8636 14.41 46.3636 14.71C45.8636 14.99 45.4736 15.39 45.1936 15.91C44.9136 16.43 44.7736 17.03 44.7736 17.71C44.7736 18.37 44.9136 18.97 45.1936 19.51C45.4736 20.03 45.8636 20.44 46.3636 20.74C46.8636 21.02 47.4336 21.16 48.0736 21.16Z"
              fill="#868EFF"
            />
          </g>
        </svg>
      </span>
      <div class="login-rect">
        <div class="main-text">
          <span class="title">Bienvenue</span>
          <span class="text"
            >Entrer vos information afin de creer un compte!</span
          >
        </div>
        <div class="main-inputs">
          <div class="input-box">
            <div class="box">
              <span class="input-text">Nom d'utilisateur</span>
              <v-text-field
                v-model="username"
                label="Entrer votre nom d'utilisateur / courriel"
                single-line
                outlined
                rounded
                full-width
                dense
                hide-details
                height="45"
              ></v-text-field>
            </div>
            <div class="box-password">
              <div class="box">
                <span class="input-text">Mot de passe</span>
                <v-text-field
                  v-model="password"
                  @keyup.native.enter="sendForm"
                  label="Entrer votre mot de passe"
                  single-line
                  outlined
                  rounded
                  full-width
                  dense
                  hide-details
                  height="45"
                  type="password"
                ></v-text-field>
                <span v-if="wrong" class="error">
                  Votre mot de passe/username est faux</span
                >
              </div>
            </div>
          </div>
          <v-btn @click="reset" v-ripple="false" text class="resetpass"
            >Mot de passe oublié ?</v-btn
          >
          <v-btn
            @click="sendForm"
            rounded
            elevation="0"
            style="
              height: 45px;
              border-radius: 8px;
              background-color: #c8e4f0;
              color: #5d4e5f;
            "
            >se connecter</v-btn
          >
          <GoogleLogin class="gbutton" :params="params" :onSuccess="onSuccess"
            >Se connecter avec Google</GoogleLogin
          >
          <v-divider></v-divider>
          <v-btn @click="signup" v-ripple="false" text class="signup-btn"
            >Pas de compte ? Créer un compte maintentant !</v-btn
          >
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { GoogleLogin } from "vue-google-login";
export default {
  name: "log-in",
  data: () => ({
    username: null,
    password: null,
    wrong: false,
    params: {
      client_id:
        "459599346269-srkk8044rkjjvgeuceqoitj78v4kre9v.apps.googleusercontent.com",
    },
  }),

  components: {
    GoogleLogin,
  },
  methods: {
    sendForm() {
      if (this.username != null || this.password != null) {
        fetch("http://localhost:8080/users/login", {
          method: "POST",
          credentials: "include",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: this.username,
            password: this.password,
          }),
        })
          .then((res) => res.json())
          .then((res) => {
            if (res.msg === 400) {
              this.wrong = true;
            } else {
              this.$router.push("Dashboard");
              //redirect here
            }
          });
      } else {
        this.wrong = true;
      }
    },
    reset() {
      this.$router.push("reset");
    },
    signup() {
      this.$router.push("signup");
    },

    onSuccess(googleUser) {
      console.log(googleUser);
      // This only gets the user information: id, name, imageUrl and email
      const user = googleUser.getBasicProfile();

      fetch("http://localhost:8080/users/googleLogin", {
        method: "POST",
        credentials: "include",
        headers: {
          Accept: "application/json",
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          username: user.name,
          email: user.email,
          imageUrl: user.imageUrl,
        }),
      })
        .then((res) => res.json())
        .then((res) => {
          if (res.msg === 400) {
            this.wrong = true;
          } else {
            this.$router.push("Dashboard");
            //redirect here
          }
        });
    },
  },
};
</script>

<style scoped lang="scss">
@import url("https://fonts.googleapis.com/css2?family=Outfit&display=swap");
.signup-page {
  font-family: Outfit, sans-serif;
  display: flex;
  flex-direction: row;
  background-color: #c8e4f0;
}

.left-rect {
  height: 100vh;
  width: 960px;
}

.left-rect {
  display: grid;
  padding: 40px;
  background-color: #f4f5ff;
  .logo {
    display: flex;
    justify-content: space-between;
  }
  .login-rect {
    display: flex;
    flex-direction: column;
    margin-left: auto;
    margin-right: auto;
    gap: 40px;
    .main-text {
      display: flex;
      flex-direction: column;
      gap: 24px;

      .title {
        font-weight: 700;
        font-size: 40px;
        line-height: 28px;
        color: #5d4e5f;
      }

      .text {
        font-size: 17px;
        line-height: 28px;
        color: rgba(63, 63, 63, 0.69);
      }
    }
    .main-inputs {
      display: flex;
      flex-direction: column;
      gap: 24px;
      .input-box {
        display: flex;
        flex-direction: column;
        gap: 12px;
        .box {
          display: flex;
          flex-direction: column;
          gap: 3px;
          .input-text {
            color: #3f3f3f;
            font-weight: 500;
            font-size: 14px;
            line-height: 28px;
          }
          .error {
            color: red;
            font-size: 12px;
            font-weight: 500;
          }
        }
        .box-password {
          display: flex;
          flex-direction: column;
          gap: 24px;
          .input-text {
            color: #3f3f3f;
            font-weight: 500;
            font-size: 14px;
            line-height: 28px;
          }
        }
      }
      .resetpass::before {
        display: none;
      }
      .resetpass {
        text-decoration-line: underline;
        justify-content: end;
      }
      .signup-btn::before {
        display: none;
      }
      .signup-btn {
        text-decoration-line: underline;
        justify-content: center !important;
      }

      .v-btn {
        height: 40px;
        font-weight: 400;
        letter-spacing: normal;
        text-transform: initial;
        color: var(--v-primary-base);
      }
    }
  }
}

.gbutton {
  transition: background-color 0.3s, box-shadow 0.3s;

  padding: 12px 16px 12px 42px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.04), 0 1px 1px rgba(0, 0, 0, 0.25);

  color: #757575;
  font-size: 14px;
  font-weight: 500;

  background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);
  background-color: white;
  background-repeat: no-repeat;
  background-position: calc(50% - 90px);

  &:hover {
    box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.04), 0 2px 4px rgba(0, 0, 0, 0.25);
  }

  &:active {
    background-color: #eeeeee;
  }

  &:focus {
    outline: none;
    box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.04), 0 2px 4px rgba(0, 0, 0, 0.25),
      0 0 0 3px #c8dafc;
  }

  &:disabled {
    filter: grayscale(100%);
    background-color: #ebebeb;
    box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.04), 0 1px 1px rgba(0, 0, 0, 0.25);
    cursor: not-allowed;
  }
}
</style>
