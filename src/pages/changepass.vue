<template>
  <div class="reset-pass">
    <span class="logo">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="111"
        height="34"
        viewBox="0 0 111 34"
        fill="none"
      >
        <g id="Noodle">
          <path
            d="M2.04 25V3.82H5.34L6.75 8.05V25H2.04ZM16.65 25L4.17 9.01L5.34 3.82L17.82 19.81L16.65 25ZM16.65 25L15.39 20.77V3.82H20.1V25H16.65ZM64.5488 25.3C63.1688 25.3 61.9388 24.97 60.8588 24.31C59.7988 23.65 58.9588 22.75 58.3388 21.61C57.7388 20.47 57.4388 19.17 57.4388 17.71C57.4388 16.25 57.7388 14.95 58.3388 13.81C58.9588 12.67 59.7988 11.77 60.8588 11.11C61.9388 10.45 63.1688 10.12 64.5488 10.12C65.5488 10.12 66.4488 10.31 67.2488 10.69C68.0688 11.07 68.7388 11.6 69.2588 12.28C69.7988 12.94 70.0988 13.7 70.1588 14.56V20.71C70.0988 21.57 69.8088 22.35 69.2888 23.05C68.7688 23.73 68.0988 24.28 67.2788 24.7C66.4588 25.1 65.5488 25.3 64.5488 25.3ZM65.3588 21.16C66.0188 21.16 66.5888 21.02 67.0688 20.74C67.5488 20.44 67.9288 20.03 68.2088 19.51C68.4888 18.99 68.6288 18.39 68.6288 17.71C68.6288 17.03 68.4888 16.44 68.2088 15.94C67.9488 15.42 67.5688 15.01 67.0688 14.71C66.5888 14.41 66.0288 14.26 65.3888 14.26C64.7488 14.26 64.1788 14.41 63.6788 14.71C63.1988 15.01 62.8088 15.42 62.5088 15.94C62.2288 16.46 62.0888 17.05 62.0888 17.71C62.0888 18.37 62.2288 18.96 62.5088 19.48C62.7888 20 63.1788 20.41 63.6788 20.71C64.1788 21.01 64.7388 21.16 65.3588 21.16ZM72.9488 25H68.4488V21.07L69.1388 17.53L68.3588 13.99V3.22H72.9488V25ZM76.1805 25V3.22H80.7705V25H76.1805ZM91.2028 25.33C89.6228 25.33 88.2128 25.01 86.9728 24.37C85.7528 23.71 84.7928 22.8 84.0928 21.64C83.3928 20.48 83.0428 19.17 83.0428 17.71C83.0428 16.25 83.3828 14.95 84.0628 13.81C84.7628 12.65 85.7028 11.74 86.8828 11.08C88.0628 10.42 89.3928 10.09 90.8728 10.09C92.3128 10.09 93.5828 10.4 94.6828 11.02C95.7828 11.64 96.6428 12.5 97.2628 13.6C97.9028 14.7 98.2228 15.96 98.2228 17.38C98.2228 17.64 98.2028 17.92 98.1628 18.22C98.1428 18.5 98.0928 18.83 98.0128 19.21L85.4428 19.24V16.09L96.0628 16.06L94.0828 17.38C94.0628 16.54 93.9328 15.85 93.6928 15.31C93.4528 14.75 93.0928 14.33 92.6128 14.05C92.1528 13.75 91.5828 13.6 90.9028 13.6C90.1828 13.6 89.5528 13.77 89.0128 14.11C88.4928 14.43 88.0828 14.89 87.7828 15.49C87.5028 16.09 87.3628 16.82 87.3628 17.68C87.3628 18.54 87.5128 19.28 87.8128 19.9C88.1328 20.5 88.5728 20.97 89.1328 21.31C89.7128 21.63 90.3928 21.79 91.1728 21.79C91.8928 21.79 92.5428 21.67 93.1228 21.43C93.7028 21.17 94.2128 20.79 94.6528 20.29L97.1728 22.81C96.4528 23.65 95.5828 24.28 94.5628 24.7C93.5428 25.12 92.4228 25.33 91.2028 25.33Z"
            fill="#402F47"
          />
          <path
            d="M30.7884 25.33C29.2884 25.33 27.9284 25 26.7084 24.34C25.5084 23.66 24.5584 22.74 23.8584 21.58C23.1584 20.42 22.8084 19.12 22.8084 17.68C22.8084 16.24 23.1584 14.95 23.8584 13.81C24.5584 12.67 25.5084 11.77 26.7084 11.11C27.9084 10.43 29.2684 10.09 30.7884 10.09C32.3084 10.09 33.6684 10.42 34.8684 11.08C36.0684 11.74 37.0184 12.65 37.7184 13.81C38.4184 14.95 38.7684 16.24 38.7684 17.68C38.7684 19.12 38.4184 20.42 37.7184 21.58C37.0184 22.74 36.0684 23.66 34.8684 24.34C33.6684 25 32.3084 25.33 30.7884 25.33ZM30.7884 21.16C31.4484 21.16 32.0284 21.02 32.5284 20.74C33.0284 20.44 33.4084 20.03 33.6684 19.51C33.9484 18.97 34.0884 18.36 34.0884 17.68C34.0884 17 33.9484 16.41 33.6684 15.91C33.3884 15.39 32.9984 14.99 32.4984 14.71C32.0184 14.41 31.4484 14.26 30.7884 14.26C30.1484 14.26 29.5784 14.41 29.0784 14.71C28.5784 14.99 28.1884 15.39 27.9084 15.91C27.6284 16.43 27.4884 17.03 27.4884 17.71C27.4884 18.37 27.6284 18.97 27.9084 19.51C28.1884 20.03 28.5784 20.44 29.0784 20.74C29.5784 21.02 30.1484 21.16 30.7884 21.16ZM48.0736 25.33C46.5736 25.33 45.2136 25 43.9936 24.34C42.7936 23.66 41.8436 22.74 41.1436 21.58C40.4436 20.42 40.0936 19.12 40.0936 17.68C40.0936 16.24 40.4436 14.95 41.1436 13.81C41.8436 12.67 42.7936 11.77 43.9936 11.11C45.1936 10.43 46.5536 10.09 48.0736 10.09C49.5936 10.09 50.9536 10.42 52.1536 11.08C53.3536 11.74 54.3036 12.65 55.0036 13.81C55.7036 14.95 56.0536 16.24 56.0536 17.68C56.0536 19.12 55.7036 20.42 55.0036 21.58C54.3036 22.74 53.3536 23.66 52.1536 24.34C50.9536 25 49.5936 25.33 48.0736 25.33ZM48.0736 21.16C48.7336 21.16 49.3136 21.02 49.8136 20.74C50.3136 20.44 50.6936 20.03 50.9536 19.51C51.2336 18.97 51.3736 18.36 51.3736 17.68C51.3736 17 51.2336 16.41 50.9536 15.91C50.6736 15.39 50.2836 14.99 49.7836 14.71C49.3036 14.41 48.7336 14.26 48.0736 14.26C47.4336 14.26 46.8636 14.41 46.3636 14.71C45.8636 14.99 45.4736 15.39 45.1936 15.91C44.9136 16.43 44.7736 17.03 44.7736 17.71C44.7736 18.37 44.9136 18.97 45.1936 19.51C45.4736 20.03 45.8636 20.44 46.3636 20.74C46.8636 21.02 47.4336 21.16 48.0736 21.16Z"
            fill="#868EFF"
          />
        </g>
      </svg>
    </span>
    <div class="reset-rect">
      <div class="main">
        <div class="mail-pic">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="91"
            height="91"
            viewBox="0 0 91 91"
            fill="none"
          >
            <circle
              cx="45.5"
              cy="45.5"
              r="33.5"
              fill="#C8E4F0"
              fill-opacity="0.63"
            />
            <circle
              cx="45.5"
              cy="45.5"
              r="45.5"
              fill="#C8E4F0"
              fill-opacity="0.21"
            />
            <path
              d="M62.8609 34.7344H33.1946C30.854 34.7344 28.9565 36.6501 28.9565 39.0132V56.1283C28.9565 58.4914 30.854 60.4071 33.1946 60.4071H62.8609C65.2015 60.4071 67.0989 58.4914 67.0989 56.1283V39.0132C67.0989 36.6501 65.2015 34.7344 62.8609 34.7344Z"
              fill="#B2B6F4"
            />
            <path
              d="M59.9268 31.8003H30.2605C27.9199 31.8003 26.0225 33.716 26.0225 36.0791V53.1942C26.0225 55.5574 27.9199 57.473 30.2605 57.473H59.9268C62.2674 57.473 64.1648 55.5574 64.1648 53.1942V36.0791C64.1648 33.716 62.2674 31.8003 59.9268 31.8003Z"
              fill="#F9DF70"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M30.2607 30.3333H59.927C63.091 30.3333 65.6321 32.919 65.6321 36.0791V53.1942C65.6321 56.3543 63.091 58.94 59.927 58.94H30.2607C27.0967 58.94 24.5557 56.3543 24.5557 53.1942V36.0791C24.5557 32.919 27.0967 30.3333 30.2607 30.3333ZM30.2607 31.8003H59.927C62.2676 31.8003 64.165 33.7159 64.165 36.0791V53.1942C64.165 55.5573 62.2676 57.473 59.927 57.473H30.2607C27.9201 57.473 26.0227 55.5573 26.0227 53.1942V36.0791C26.0227 33.7159 27.9201 31.8003 30.2607 31.8003Z"
              fill="#763B28"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M30.4239 34.0007C29.2086 34.0007 28.2234 34.9859 28.2234 36.2012V49.4044C28.2234 49.8095 27.895 50.1379 27.4899 50.1379C27.0847 50.1379 26.7563 49.8095 26.7563 49.4044V36.2012C26.7563 34.1757 28.3984 32.5337 30.4239 32.5337H42.16C42.5651 32.5337 42.8935 32.8621 42.8935 33.2672C42.8935 33.6723 42.5651 34.0007 42.16 34.0007H30.4239Z"
              fill="white"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M26.6343 55.4096C27.2667 55.7884 28.005 56.0059 28.7937 56.0059H58.46C60.8006 56.0059 62.698 54.0902 62.698 51.7271V34.6119C62.698 33.801 62.4746 33.0427 62.0864 32.3965C63.3309 33.1419 64.165 34.5121 64.165 36.0789V53.1941C64.165 55.5572 62.2676 57.4729 59.927 57.4729H30.2607C28.7233 57.4729 27.3772 56.6464 26.6343 55.4096Z"
              fill="#E7C63C"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M29.7872 35.1038C29.9882 34.7521 30.4363 34.6299 30.788 34.8309L45.8277 43.425L60.8674 34.8309C61.2192 34.6299 61.6672 34.7521 61.8682 35.1038C62.0692 35.4556 61.947 35.9036 61.5953 36.1046L46.1916 44.9067C45.9661 45.0356 45.6893 45.0356 45.4638 44.9067L30.0601 36.1046C29.7084 35.9036 29.5862 35.4556 29.7872 35.1038Z"
              fill="#E7C63C"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M29.0533 34.3704C29.2543 34.0187 29.7024 33.8965 30.0541 34.0975L45.0938 42.6916L60.1335 34.0975C60.4853 33.8965 60.9333 34.0187 61.1343 34.3704C61.3353 34.7222 61.2131 35.1702 60.8614 35.3712L45.4577 44.1733C45.2322 44.3022 44.9554 44.3022 44.7299 44.1733L29.3263 35.3712C28.9745 35.1702 28.8523 34.7222 29.0533 34.3704Z"
              fill="#763B28"
            />
          </svg>
        </div>
        <div class="main2">
          <div class="texts">
            <span class="title">Changer votre Mot de passe!</span>
            <span class="under-text"
              >Veuiller mettre votre nouveau mot de passe</span
            >
          </div>
          <div v-if="state.inputs" class="main-inputs">
            <div class="input-box">
              <div class="box">
                <span class="input-text">Password</span>
                <v-text-field
                  v-model="state.password"
                  v-on:keyup.native.enter="sendForm"
                  label="Entrer Votre Mot de Passe"
                  single-line
                  outlined
                  rounded
                  full-width
                  dense
                  hide-details
                  height="45"
                  type="password"
                ></v-text-field>
                <span v-if="v$.password.$error" class="error">{{
                  v$.password.$errors[0].$message
                }}</span>
              </div>
              <div class="box">
                <v-text-field
                  v-model="state.confirmed"
                  v-on:keyup.enter="sendForm"
                  label="Verifier votre mot de passe"
                  single-line
                  outlined
                  rounded
                  full-width
                  dense
                  hide-details
                  height="45"
                  type="password"
                ></v-text-field>
                <span v-if="v$.confirmed.$error" class="error">{{
                  v$.confirmed.$errors[0].$message
                }}</span>
              </div>
              <span v-if="state.same" class="error">
                Ce Mot de passe est le même que celui d'avant</span
              >
              <v-btn
                v-on:click="sendForm"
                rounded
                elevation="0"
                style="
                  height: 45px;
                  border-radius: 8px;
                  background-color: #c8e4f0;
                  color: #5d4e5f;
                "
                >Changer le mdp
              </v-btn>
            </div>
          </div>
          <div v-else-if="state.success" class="success">
            <svg
              class="checkmark"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 52 52"
            >
              <circle
                class="checkmark__circle"
                cx="26"
                cy="26"
                r="25"
                fill="none"
              />
              <path
                class="checkmark__check"
                fill="none"
                d="M14.1 27.2l7.1 7.2 16.7-16.8"
              />
            </svg>
            <span class="successtext"> Votre mot de passe a été changer</span>
          </div>
          <div v-else-if="state.wrong" class="success">
            <svg
              class="xmark"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 52 52"
            >
              <circle
                class="xmark__circle"
                cx="26"
                cy="26"
                r="25"
                fill="none"
              />
              <path
                class="xmark__check"
                fill="none"
                d="M16 16 36 36 M36 16 16 36"
              />
            </svg>
            <span class="wrongText"> Ce lien est expirer ou est invalide</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import useValidate from "@vuelidate/core";
import { required, sameAs, helpers, minLength } from "@vuelidate/validators";
import { reactive, computed } from "vue";

export default {
  name: "changePassword",
  setup() {
    const state = reactive({
      password: null,
      success: false,
      confirmed: null,
      inputs: true,
      wrong: false,
      same: false,
    });
    const rules = computed(() => {
      return {
        password: {
          required: helpers.withMessage(
            "Veuiller ecrire votre nouveau mot de passe",
            required
          ),
        },
        confirmed: {
          required,
          sameAs: helpers.withMessage(
            "Les mots de passes sont pas les memes",
            sameAs(state.password)
          ),
          minLength: helpers.withMessage(
            "Vueiller écrire au moins 6 charactére",
            minLength(6)
          ),
        },
      };
    });
    const v$ = useValidate(rules, state);
    return {
      state,
      v$,
    };
  },

  methods: {
    sendForm() {
      this.v$.$validate();
      if (!this.v$.$error) {
        const value = document.URL.split("/changePass/")[1];
        console.log(value);
        fetch(`http://localhost:8080/reset-pass/${value}`, {
          method: "POST",
          credentials: "include",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            password: this.state.password,
          }),
        })
          .then((res) => {
            if (res.status === 200) {
              this.state.success = true;
              this.state.inputs = false;
              //redirect here
            } else if (res.status === 401) {
              this.state.same = true;
            } else {
              this.state.wrong = true;
              this.state.inputs = false;
            }
          })
          .catch((err) => {
            console.error(err);
          });
      }
    },
  },
};
</script>

<style scoped lang="scss">
@import url("https://fonts.googleapis.com/css2?family=Outfit&display=swap");

.reset-pass {
  overflow: hidden;
  font-family: Outfit, sans-serif;
  height: 100vh;
  width: 100%;
  background-color: #f4f5ff;
}

.mail-pic {
  width: fit-content;
}
.logo {
  margin: 32px 25% 0 6%;
  display: flex;
  justify-content: space-between;
}
.reset-rect {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 40px;

  .main {
    display: flex;
    flex-direction: column;
    gap: 40px;
    align-items: center;
    .main2 {
      display: flex;
      flex-direction: column;
      gap: 48px;
      .texts {
        display: flex;
        flex-direction: column;
        gap: 14px;

        .title {
          font-weight: 700;
          font-size: 40px;
          line-height: 28px;
          text-transform: capitalize;
          color: #5d4e5f;
        }

        .under-text {
          font-weight: 400;
          font-size: 16px;
          line-height: 28px;
          text-transform: capitalize;
          color: rgba(63, 63, 63, 0.69);
        }
      }

      .main-inputs {
        display: flex;
        flex-direction: column;
        gap: 24px;

        .input-box {
          display: flex;
          flex-direction: column;
          gap: 32px;

          .box {
            display: flex;
            flex-direction: column;

            .input-text {
              color: rgba(63, 63, 63, 0.69);
              font-weight: 500;
              font-size: 14px;
              line-height: 28px;
            }
          }
        }
        .btn {
          font-size: 15px;
          line-height: 30px;

          color: rgba(63, 63, 63, 0.69);
        }
      }
      .success {
        display: flex;
        flex-direction: column;
        background-color: #c8e4f0;
        height: 240px;
        border-radius: 20px;
        text-align: center;
        .successtext {
          font-weight: 400;
          font-size: 24px;
          line-height: 28px;
          text-transform: capitalize;
          color: #6dc400;
        }
        .wrongText {
          font-weight: 400;
          font-size: 24px;
          line-height: 28px;
          text-transform: capitalize;
          color: red;
        }
      }
    }
  }
}
.v-text-field--outlined {
  border-radius: 8px;

  opacity: 30%;
  color: #3f3f3f;
  background-color: white;
}
.v-btn {
  height: 40px;
  font-weight: 400;
  font-size: 16px;
  line-height: 28px;
  letter-spacing: normal;
  text-transform: capitalize;
}
.checkmark__circle {
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 2;
  stroke-miterlimit: 10;
  stroke: #7ac142;
  fill: none;
  animation: stroke1 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

.checkmark {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: block;
  stroke-width: 2;
  stroke: #fff;
  stroke-miterlimit: 10;
  margin: 10% auto;
  box-shadow: inset 0 0 0 #7ac142;
  animation: fill1 0.4s ease-in-out 0.4s forwards,
    scale1 0.3s ease-in-out 0.9s both;
}

.checkmark__check {
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: stroke1 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}

@keyframes stroke1 {
  100% {
    stroke-dashoffset: 0;
  }
}
@keyframes scale1 {
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
}
@keyframes fill1 {
  100% {
    box-shadow: inset 0 0 0 30px #7ac142;
  }
}
.xmark__circle {
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 2;
  stroke-miterlimit: 10;
  stroke: red;
  fill: none;
  animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}
.xmark {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: block;
  stroke-width: 2;
  stroke: #fff;
  stroke-miterlimit: 10;
  margin: 10% auto;
  box-shadow: inset 0 0 0 red;
  animation: fill 0.4s ease-in-out 0.4s forwards,
    scale 0.3s ease-in-out 0.9s both;
}
.xmark__check {
  transform-origin: 50% 50%;
  stroke-dasharray: 29;
  stroke-dashoffset: 29;
  animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}
@keyframes stroke {
  100% {
    stroke-dashoffset: 0;
  }
}
@keyframes scale {
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
}
@keyframes fill {
  100% {
    box-shadow: inset 0 0 0 30px red;
  }
}
.error {
  color: red;
  font-size: 12px;
  font-weight: 500;
}
</style>
